!function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t["default"]:t,!function(t){t="default"in t?t["default"]:t;var e={};e.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var n=function(t,e){var n=function(t){var e={key:t,isOptional:!1},n=t.split("?");return""===n[0]&&(e.key=n[1],e.isOptional=!0),e};return t.split(e).map(n)},i=function(){function t(n){e.classCallCheck(this,t);try{this.separator=n.get("ngSmartIdSeparator")}catch(i){this.separator=":"}try{this.patterns=n.get("ngSmartIdPatterns")}catch(i){this.patterns={}}}return e.createClass(t,[{key:"parse",value:function(t,e){var i=t.split(this.separator),r=void 0,a=i.reduce(function(t,e){return r?(t[r]=e,r=void 0):r=e,t},{});if(e){e=this.patterns[e]||e;var o=n(e,this.separator);o.forEach(function(t){if(!a[t.key]&&!t.isOptional)throw new Error("could not parse the id, non optional field "+t.key+" missing")})}return a}},{key:"idify",value:function(t,e){var i=this,r=function(t){return"undefined"!=typeof t&&null!==t&&""!==t};e=this.patterns[e]||e;var a=n(e,this.separator);return a.reduce(function(e,n){var a=t[n.key];if(a&&r(a))return e+(e.length?i.separator+n.key:n.key)+i.separator+a;if(!n.isOptional)throw new Error("could not generate id, missing field "+n.key);return e},"")}}]),t}();i.$inject=["$injector"],t.module("ngSmartId",[]).service("smartId",i)}(angular);var n=(e(function(t,e){"undefined"!=typeof t&&"undefined"!=typeof e&&t.exports===e&&(t.exports="pouchdb"),function(t,e,n){e.module("pouchdb",[]).constant("POUCHDB_METHODS",{destroy:"qify",put:"qify",post:"qify",get:"qify",remove:"qify",bulkDocs:"qify",bulkGet:"qify",allDocs:"qify",putAttachment:"qify",getAttachment:"qify",removeAttachment:"qify",query:"qify",viewCleanup:"qify",info:"qify",compact:"qify",revsDiff:"qify",changes:"eventEmitter",sync:"eventEmitter",replicate:{to:"eventEmitter",from:"eventEmitter"}}).service("pouchDBDecorators",["$q",function(t){this.qify=function(e){return function(){return t.when(e.apply(this,arguments))}},this.eventEmitter=function(e){return function(){var n=t.defer(),i=e.apply(this,arguments).on("change",function(t){return n.notify({change:t})}).on("paused",function(t){return n.notify({paused:t})}).on("active",function(t){return n.notify({active:t})}).on("denied",function(t){return n.notify({denied:t})}).on("complete",function(t){return n.resolve(t)}).on("error",function(t){return n.reject(t)});return i.$promise=n.promise,i}}}]).provider("pouchDB",["POUCHDB_METHODS",function(t){var n=this;n.methods=t,n.$get=["$window","pouchDBDecorators",function(t,i){function r(t,n,a){for(var o in n){var c=n[o];e.isString(c)?(c=i[c],a?t[a][o]=c(t[a][o]):t[o]=c(t[o])):r(t,c,o)}return t}return function(e,i){var a=new t.PouchDB(e,i);return r(a,n.methods)}}]}])}(window,window.angular)}),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t,e){t.then(e)},a=function(){function t(e,i,r){n(this,t);var a=void 0;try{a=e.get("dataModuleRemoteDB")}catch(o){throw new Error("dataModuleRemoteDB should be provided in the data module configuration")}this.pouchDB=i,this.angularNavDataUtilsService=r,this.remoteDB=this.pouchDB(a),this.replicationFrom,this.localDB,this.registeredOnReplicationCompleteCallbackIds=[],this.callbacksPendingRegistration=[]}return i(t,[{key:"startReplication",value:function(t,e){var n={filter:"locations/by-state",query_params:{zone:t,state:e}};for(this.localDB=this.pouchDB("navIntLocationsDB"),this.replicationFrom=this.localDB.replicate.from(this.remoteDB,n);this.callbacksPendingRegistration.length;){var i=this.callbacksPendingRegistration.shift();r(this.replicationFrom,i)}}},{key:"callOnReplicationComplete",value:function(t,e){-1===this.registeredOnReplicationCompleteCallbackIds.indexOf(t)&&(this.registeredOnReplicationCompleteCallbackIds.push(t),this.replicationFrom?r(this.replicationFrom,e):this.callbacksPendingRegistration.push(e))}},{key:"allDocs",value:function(t){var e=this.localDB||this.remoteDB;return this.angularNavDataUtilsService.allDocs(e,t)}}]),t}();a.$inject=["$injector","pouchDB","angularNavDataUtilsService"];var o=function(){function t(e,i,r){n(this,t),this.cachedLgasByState={},this.cachedLgaIdsByState={},this.defaultZone,this.defaultState,this.$q=e,this.smartId=i,this.locationsService=r,this.locationsService.callOnReplicationComplete("lgas-service",this.byState.bind(this))}return i(t,[{key:"queryAndUpdateCache",value:function(t,e){var n=this,i=function(t){return t.id},r=function(t){return t.id=n.smartId.parse(t._id).lga,t},a=function(t,e){var i={include_docs:!0,ascending:!0,startkey:"zone:"+t+":state:"+e+":",endkey:"zone:"+t+":state:"+e+":￿"};return n.locationsService.allDocs(i)},o=function(t,e){n.cachedLgasByState[t]=e.map(r),n.cachedLgaIdsByState[t]=n.cachedLgasByState[t].map(i)};return a(t,e).then(o.bind(null,e))}},{key:"byState",value:function(t,e){return t=t||this.defaultZone,e=e||this.defaultState,this.cachedLgasByState[e]?this.$q.when(this.cachedLgasByState[e]):this.queryAndUpdateCache(t,e).then(function(){return this.cachedLgasByState[e]}.bind(this))}},{key:"idsByState",value:function(t,e){return t=t||this.defaultZone,e=e||this.defaultState,this.cachedLgasByState[e]?this.$q.when(this.cachedLgaIdsByState[e]):this.queryAndUpdateCache(t,e).then(function(){return this.cachedLgaIdsByState[e]}.bind(this))}},{key:"setState",value:function(t,e){this.defaultZone=t,this.defaultState=e}},{key:"get",value:function(t){var e=function(e){var n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var c=a.value;if(c._id===t)return c}}catch(s){i=!0,r=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw r}}},n=this.smartId.parse(t).state,i=this.smartId.parse(t).zone;return this.byState(i,n).then(e)}}]),t}();o.$inject=["$q","smartId","locationsService"];var c=function(){function t(e,i,r){n(this,t),this.cachedStatesByZone={},this.cachedStateIdsByZone={},this.defaultZone,this.$q=e,this.smartId=i,this.locationsService=r,this.locationsService.callOnReplicationComplete("states-service",this.byZone.bind(this))}return i(t,[{key:"queryAndUpdateCache",value:function(t){var e=this,n=function(t){return t.id},i=function(t){return t.id=e.smartId.parse(t._id).state,t},r=function(t){return t.filter(function(t){return"state"===t.level})},a=function(t){var n={include_docs:!0,ascending:!0,startkey:"zone:"+t+":",endkey:"zone:"+t+":￿"};return e.locationsService.allDocs(n).then(r)},o=function(t,r){e.cachedStatesByZone[t]=r.map(i),e.cachedStateIdsByZone[t]=e.cachedStatesByZone[t].map(n)};return a(t).then(o.bind(null,t))}},{key:"byZone",value:function(t){return t=t||this.defaultZone,this.cachedStatesByZone[t]?this.$q.when(this.cachedStatesByZone[t]):this.queryAndUpdateCache(t).then(function(){return this.cachedStatesByZone[t]}.bind(this))}},{key:"idsByZone",value:function(t){return t=t||this.defaultZone,this.cachedStatesByZone[t]?this.$q.when(this.cachedStateIdsByZone[t]):this.queryAndUpdateCache(t).then(function(){return this.cachedStateIdsByZone[t]}.bind(this))}},{key:"setZone",value:function(t){this.defaultZone=t}},{key:"get",value:function(t){var e=function(e){var n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var c=a.value;if(c._id===t)return c}}catch(s){i=!0,r=s}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw r}}},n=this.smartId.parse(t).zone;return this.byZone(n).then(e)}}]),t}();c.$inject=["$q","smartId","locationsService"];var s=function(t){return t.doc},u=function(t){return t.rows.map(s)},l=function(){function t(){n(this,t)}return i(t,[{key:"allDocs",value:function(t,e){return t.allDocs(e).then(u)}}]),t}(),h="angularNavData.utils";t.module(h,[]).service("angularNavDataUtilsService",l);var d="angularNavData.locations";t.module(d,[h,"ngSmartId","pouchdb"]).service("locationsService",a).service("lgasService",o).service("statesService",c);var f=function(t,e){t.then(e)},v=function(){function t(e,i,r){n(this,t);var a=void 0;try{a=e.get("dataModuleRemoteDB")}catch(o){throw new Error("dataModuleRemoteDB should be provided in the data module configuration")}this.pouchDB=i,this.angularNavDataUtilsService=r,this.remoteDB=this.pouchDB(a),this.replicationFrom,this.localDB,this.registeredOnReplicationCompleteCallbackIds=[],this.callbacksPendingRegistration=[]}return i(t,[{key:"startReplication",value:function(t,e){var n={filter:"products/all"};for(this.localDB=this.pouchDB("navIntProductsDB"),this.replicationFrom=this.localDB.replicate.from(this.remoteDB,n);this.callbacksPendingRegistration.length;){var i=this.callbacksPendingRegistration.shift();f(this.replicationFrom,i)}}},{key:"callOnReplicationComplete",value:function(t,e){-1===this.registeredOnReplicationCompleteCallbackIds.indexOf(t)&&(this.registeredOnReplicationCompleteCallbackIds.push(t),this.replicationFrom?f(this.replicationFrom,e):this.callbacksPendingRegistration.push(e))}},{key:"allDocs",value:function(t){var e=this.localDB||this.remoteDB;return this.angularNavDataUtilsService.allDocs(e,t)}}]),t}();v.$inject=["$injector","pouchDB","angularNavDataUtilsService"];var p=function(){function t(e,i){n(this,t),this.cachedProducts=[],this.cachedDryProducts=[],this.cachedFrozenProducts=[],this.relevant,this.$q=e,this.productsService=i,this.productsService.callOnReplicationComplete("products-list-service",this.all.bind(this))}return i(t,[{key:"queryAndUpdateCache",value:function(){var t=this,e=function(){var e={include_docs:!0};return t.relevant?e.keys=t.relevant:(e.ascending=!0,e.startkey="product:",e.endkey="product:￿"),t.productsService.allDocs(e)},n=function(t){return"dry"===t.storageType},i=function(t){return"frozen"===t.storageType},r=function(t){return"undefined"!=typeof t},a=function(e){t.cachedProducts=e.filter(r),t.cachedDryProducts=t.cachedProducts.filter(n),t.cachedFrozenProducts=t.cachedProducts.filter(i)};return e().then(a)}},{key:"all",value:function(){return!this.cachedProducts.length>0?this.queryAndUpdateCache().then(function(){return this.cachedProducts}.bind(this)):this.$q.when(this.cachedProducts)}},{key:"dry",value:function(){return!this.cachedDryProducts.length>0?this.queryAndUpdateCache().then(function(){return this.cachedDryProducts}.bind(this)):this.$q.when(this.cachedDryProducts)}},{key:"frozen",value:function(){return!this.cachedFrozenProducts.length>0?this.queryAndUpdateCache().then(function(){return this.cachedFrozenProducts}.bind(this)):this.$q.when(this.cachedFrozenProducts)}},{key:"setRelevant",value:function(t){this.relevant=t}}]),t}();p.$inject=["$q","productsService"];var y="angularNavData.products";t.module(y,[h,"pouchdb"]).service("productsService",v).service("productListService",p),t.module("angularNavData",[d,y])}(angular);